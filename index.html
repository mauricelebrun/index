<!DOCTYPE html>
<html>
  <head>
    <style>
      .glitch-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: fit-content;
        height: 100%;
        display: grid;
        pointer-events: none;
        overflow: hidden;
      }

      .glitch-rect {
        width: 10px;
        height: 10px;
        background: black;
        opacity: 1;
        transition: opacity 0.15s ease;
      }

      @font-face {
        font-family: "Avenir Black";
        src: url(assets/Avenir\ Black.ttf);
      }

      @font-face {
        font-family: "Avenir Book";
        src: url(assets/Avenir\ Book.ttf);
      }

      @font-face {
        font-family: "Avenir Heavy";
        src: url(assets/Avenir\ Heavy.ttf);
      }

      html,
      body {
        height: 100%;
        margin: 0;
      }

      .container {
        width: 60%;
        height: 100%;
        margin: 0 auto;
        margin-top: 50px;
      }

      .content {
        width: 1000px;
        position: relative;
      }

      .caroussel-container {
        margin-top: 40px;
        margin-bottom: 50px;
        color: #727272;
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out,
          margin-top 0.5s ease-in-out;
      }

      .caroussel-container.visible {
        max-height: 500px;
        opacity: 1;
      }

      .maurice-lebrun {
        padding-top: 5px;
        font-family: "Avenir Black";
        margin: 0;
        font-size: 60px;
        line-height: 0.8;
        letter-spacing: 2px;
        white-space: pre;
        position: relative;
        overflow: hidden;
      }

      p.headline {
        font-family: "Avenir Book";
        margin: 0;
      }

      p.location {
        font-family: "Avenir Book";
        margin: 0;
      }

      p.description-project {
        font-family: "Avenir Book";
      }

      .description-project > a {
        border: 1px solid black;
        padding: 0 5px;
        text-decoration: none;
        color: black;
        position: relative;
        transition: all 0.2s;
      }

      .description-project > a:hover {
        color: rgb(103, 100, 100);
        border: 1px solid rgb(87, 85, 85);
      }

      .caroussel-image {
        display: flex;
        gap: 20px;
        align-items: flex-start;
      }

      .carousel-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .carousel-viewport {
        overflow: hidden;
        /* Width of 3 images (150px each) + 2 gaps (5px each) */
        width: calc(150px * 3 + 5px * 2);
      }

      .images-wrapper {
        display: flex;
        gap: 5px;
        /* Smooth transition for sliding */
        transition: transform 0.5s ease-in-out;
      }

      .carousel-button {
        background: none;
        border: none;
        font-size: 1.4rem;
        font-weight: bold;
        color: #3f3f3fff;
        cursor: pointer;
        padding: 0 10px;
        transition: color 0.2s;
      }

      .carousel-button:hover {
        color: #000;
      }

      .carousel-button.hidden {
        visibility: hidden;
      }

      p.word-description {
        font-family: "Avenir Book";
        text-align: left;
        max-width: 280px;
      }

      span.word {
        font-family: "Avenir Book";
        font-weight: bold;
        font-style: oblique;
        cursor: pointer;
        transition: color 0.2s ease;
        position: relative;
        color: #727272;
      }

      span.word:not(:last-child):after {
        content: ", ";
        font-weight: normal;
        font-style: normal;
      }

      span.word.moving {
        position: fixed;
        transition: all 0.5s ease-in-out;
        z-index: 1000;
      }

      span.word.moving:after,
      span.word.at-top:after {
        content: none;
      }

      span.word.at-top {
        position: absolute;
        color: black;
      }

      span.word-highlight {
        font-family: "Avenir Book";
        color: black;
      }

      span.word:hover {
        font-family: "Avenir Book";
        color: black;
      }

      div.all-words {
        margin-top: 20px;
        margin-bottom: 30px;
        max-width: 400px;
        transition: margin-top 0.5s ease-in-out;
      }

      div.all-words.pushed {
        margin-top: 10px;
      }

      .selected-word-placeholder {
        display: none;
      }

      .selected-word-container {
        margin-bottom: 10px;
        min-height: 20px;
        position: relative;
      }

      .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
      }

      .lightbox.visible {
        opacity: 1;
        pointer-events: all;
      }

      .lightbox img {
        max-width: 90vw;
        max-height: 80vh;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        border-radius: 4px;
      }

      .lightbox-content {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        text-align: left;
      }

      .lightbox-label {
        margin-top: 8px;
        font-family: "Avenir Black";
        font-size: 20px;
        color: white;
      }

      .images-wrapper img {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="content">
        <h1 class="maurice-lebrun"><span>MAURICE LEBRUN</span></h1>
        <p class="headline">
          <span>ARTS NUMÉRIQUES VISUELS & SONORES / DOCUMENTAIRE</span>
        </p>
        <p class="location">Bordeaux - FRANCE</p>
        <div class="caroussel-container">
          <div class="selected-word-container"></div>
          <div class="caroussel-image">
            <div class="carousel-wrapper">
              <button id="prevBtn" class="carousel-button">&#9664;</button>
              <div class="carousel-viewport">
                <div class="images-wrapper"></div>
              </div>
              <button id="nextBtn" class="carousel-button">&#9654;</button>
            </div>
            <p class="word-description"></p>
          </div>
        </div>
        <!-- list des projets -->
        <div class="all-words">
          <span class="word">SOMA [NEW]</span
          ><span class="word">JUSTICE & MECAOCTET [NEW]</span
          ><span class="word">GRAN TURISMO [NEW]</span>
          <span class="word">Photographie</span
          ><span class="word">Films</span
          ><span class="word">Musique</span>
        </div>
        <a href="mailto:contact.mauricelebrun@proton.me"
          ><img
            src="./assets/letter.jpg"
            width="30px"
            alt="Image d'une lettre postale"
        /></a>
      </div>
    </div>
    <script>
      window.addEventListener("DOMContentLoaded", async () => {
        const response = await fetch("./assets/projects.json");
        const wordToClass = await response.json();

        const words = document.querySelectorAll(".word");
        const descriptionElement = document.querySelector(".word-description");
        const carousselContainer = document.querySelector(
          ".caroussel-container"
        );
        const allWordsContainer = document.querySelector(".all-words");
        const selectedWordContainer = document.querySelector(
          ".selected-word-container"
        );

        let carouselVisible = false;
        let currentSelectedWord = null;
        let wordOriginalPositions = new Map();

        // Store original positions of all words
        words.forEach((word) => {
          const rect = word.getBoundingClientRect();
          wordOriginalPositions.set(word, {
            top: rect.top,
            left: rect.left,
          });
        });

        const imagesWrapper = document.querySelector(".images-wrapper");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        const ITEMS_TO_SHOW = 3;
        const IMAGE_WIDTH = 150;
        const GAP = 5;
        const SLIDE_WIDTH = IMAGE_WIDTH + GAP;

        let activeIndex = 0;
        let currentImages = [];
        let isTransitioning = false;

        function updateCarousel(images) {
          currentImages = images;
          activeIndex = 0;
          imagesWrapper.innerHTML = "";
          imagesWrapper.style.transition = "none"; // Disable transitions during setup

          // Hide buttons if not enough images for a carousel
          if (currentImages.length <= ITEMS_TO_SHOW) {
            prevBtn.classList.add("hidden");
            nextBtn.classList.add("hidden");
            // Just display the images without cloning
            images.forEach((src) => {
              const img = document.createElement("img");
              img.src = src;
              img.width = IMAGE_WIDTH;
              imagesWrapper.appendChild(img);
            });
            imagesWrapper.style.transform = "translateX(0px)";
            return;
          }

          prevBtn.classList.remove("hidden");
          nextBtn.classList.remove("hidden");

          // 1. Create clones for infinite loop
          const clonesStart = images.slice(-ITEMS_TO_SHOW); // Last 3 images
          const clonesEnd = images.slice(0, ITEMS_TO_SHOW); // First 3 images

          // 2. Populate the wrapper: [clones of end, real images, clones of start]
          const allSlides = [...clonesStart, ...images, ...clonesEnd];

          allSlides.forEach((src) => {
            const img = document.createElement("img");
            img.src = src;
            img.width = IMAGE_WIDTH;
            imagesWrapper.appendChild(img);
          });

          // 3. Set initial position to show the start of the "real" images
          const initialOffset = -SLIDE_WIDTH * ITEMS_TO_SHOW;
          imagesWrapper.style.transform = `translateX(${initialOffset}px)`;

          // Use a timeout to re-enable transitions after the initial position is set
          setTimeout(() => {
            imagesWrapper.style.transition = "transform 0.5s ease-in-out";
          }, 50);
        }

        function moveToNext() {
          if (isTransitioning) return;
          isTransitioning = true;
          activeIndex++;
          const offset = -SLIDE_WIDTH * (activeIndex + ITEMS_TO_SHOW);
          imagesWrapper.style.transform = `translateX(${offset}px)`;
        }

        function moveToPrev() {
          if (isTransitioning) return;
          isTransitioning = true;
          activeIndex--;
          const offset = -SLIDE_WIDTH * (activeIndex + ITEMS_TO_SHOW);
          imagesWrapper.style.transform = `translateX(${offset}px)`;
        }

        function handleTransitionEnd() {
          // If we've slid to a clone at the end, jump back to the start of real images
          if (activeIndex >= currentImages.length) {
            imagesWrapper.style.transition = "none";
            activeIndex = 0;
            const offset = -SLIDE_WIDTH * (activeIndex + ITEMS_TO_SHOW);
            imagesWrapper.style.transform = `translateX(${offset}px)`;
            // If we've slid to a clone at the start, jump back to the end of real images
          } else if (activeIndex < 0) {
            imagesWrapper.style.transition = "none";
            activeIndex = currentImages.length - 1;
            const offset = -SLIDE_WIDTH * (activeIndex + ITEMS_TO_SHOW);
            imagesWrapper.style.transform = `translateX(${offset}px)`;
          }

          // Re-enable transitions after the jump
          setTimeout(() => {
            imagesWrapper.style.transition = "transform 0.5s ease-in-out";
          }, 50);

          isTransitioning = false;
        }

        nextBtn.addEventListener("click", moveToNext);
        prevBtn.addEventListener("click", moveToPrev);
        imagesWrapper.addEventListener("transitionend", handleTransitionEnd);

        function moveWordToTop(word) {
          // Get current position of word
          const startRect = word.getBoundingClientRect();

          // Get target position (top-left of carousel container)
          const targetRect = selectedWordContainer.getBoundingClientRect();

          // Create placeholder to maintain space in word cloud
          const placeholder = document.createElement("span");
          placeholder.className = "selected-word-placeholder";
          placeholder.textContent = word.textContent;
          word.parentNode.insertBefore(placeholder, word);

          // Set word to fixed position at its current location
          word.classList.add("moving");
          word.style.top = startRect.top + "px";
          word.style.left = startRect.left + "px";

          // Force reflow
          word.offsetHeight;

          // Animate to target position
          word.style.top = targetRect.top + "px";
          word.style.left = targetRect.left + "px";

          // After animation completes, position it absolutely within container
          setTimeout(() => {
            word.classList.remove("moving");
            word.classList.add("at-top");
            word.style.top = "";
            word.style.left = "";
            selectedWordContainer.appendChild(word);
          }, 500);

          return placeholder;
        }

        function removeWord(word, placeholder) {
          if (!placeholder || !placeholder.parentNode) return;

          // Get current position
          const startRect = word.getBoundingClientRect();

          // Get target position (where placeholder is)
          const targetRect = placeholder.getBoundingClientRect();

          // Remove from top container and set to fixed at current position
          word.classList.remove("at-top");
          word.classList.add("moving");
          document.body.appendChild(word);

          // Force reflow
          word.offsetHeight;

          // Animate back to placeholder position
          //word.style.top = targetRect.top + "px";
          //word.style.left = targetRect.left + "px";

          // After animation, put it back in place
          setTimeout(() => {
            word.classList.remove("moving");
            word.style.top = "";
            word.style.left = "";
            word.style.color = "#727272";
            placeholder.parentNode.replaceChild(word, placeholder);
          }, 500);
        }

        let currentPlaceholder = null;

        words.forEach((word) => {
          word.addEventListener("click", () => {
            if (word === currentSelectedWord) return;

            const openNewProject = () => {
              // Move new word to top
              currentPlaceholder = moveWordToTop(word);
              currentSelectedWord = word;

              const wordData = wordToClass[word.textContent.trim()];
              descriptionElement.className = "description-project";
              descriptionElement.innerHTML = wordData
                ? wordData.description
                : "";
              updateCarousel(wordData ? wordData.images : []);

              // Show carousel + push cloud
              carousselContainer.classList.add("visible");
              allWordsContainer.classList.add("pushed");
            };

            // If the carousel is not open yet → just open normally
            if (!carouselVisible) {
              carouselVisible = true;
              openNewProject();
              return;
            }

            // If it *is* open → close first
            carousselContainer.classList.remove("visible");
            allWordsContainer.classList.remove("pushed");

            // After close animation finishes:
            setTimeout(() => {
              // Move back previous selected word
              if (currentSelectedWord && currentPlaceholder) {
                removeWord(currentSelectedWord, currentPlaceholder);
              }

              // Now open with new selected word
              openNewProject();
            }, 500); // match the CSS transition duration
          });
        });

        const lightbox = document.createElement("div");
        lightbox.classList.add("lightbox");

        const lightboxContent = document.createElement("div");
        lightboxContent.classList.add("lightbox-content");

        const lightboxImg = document.createElement("img");
        const lightboxLabel = document.createElement("div");
        lightboxLabel.classList.add("lightbox-label");
        lightboxLabel.textContent = "highlight";

        lightboxContent.appendChild(lightboxImg);
        lightboxContent.appendChild(lightboxLabel);
        lightbox.appendChild(lightboxContent);
        document.body.appendChild(lightbox);

        document.addEventListener("click", (e) => {
          const target = e.target;
          if (target.tagName === "IMG" && target.closest(".images-wrapper")) {
            if (!currentSelectedWord) return;

            lightboxImg.src = target.src;
            lightboxLabel.textContent = currentSelectedWord.textContent.trim(); // show selected word
            lightbox.classList.add("visible");
          } else if (target === lightbox) {
            lightbox.classList.remove("visible");
          }
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && lightbox.classList.contains("visible")) {
            lightbox.classList.remove("visible");
          }
        });
      });
    </script>
    <script>
      function glitchText(targetSelector, duration = 700) {
        const el = document.querySelector(targetSelector);
        const rect = el.getBoundingClientRect();

        const overlay = document.createElement("div");
        overlay.style.position = "absolute";
        overlay.style.top = 0;
        overlay.style.left = 0;
        overlay.style.width = rect.width + "px";
        overlay.style.height = rect.height + "px";
        overlay.style.pointerEvents = "none";
        overlay.style.overflow = "hidden";

        el.style.position = "relative";
        el.style.color = "transparent";
        el.appendChild(overlay);

        function spawnRects() {
          overlay.innerHTML = "";
          const rectCount = 2;

          for (let i = 0; i < rectCount; i++) {
            const r = document.createElement("div");
            const w = 5 + Math.random() * 300;
            const h = 5 + Math.random() * 50;
            const x = Math.random() * (rect.width - w);
            const y = Math.random() * (rect.height - h);

            r.style.position = "absolute";
            r.style.left = x + "px";
            r.style.top = y + "px";
            r.style.width = w + "px";
            r.style.height = h + "px";
            r.style.background = "black";
            r.style.opacity = Math.random() * 0.9;

            overlay.appendChild(r);
          }
        }

        spawnRects();
        const scramble = setInterval(spawnRects, 80);

        setTimeout(() => {
          clearInterval(scramble);

          overlay.innerHTML = "";

          const bar = document.createElement("div");
          bar.style.position = "absolute";
          bar.style.left = rect.width * 0.05 + "px";
          bar.style.top = rect.height / 2 - 5 + "px";
          bar.style.width = rect.width * 0.9 + "px";
          bar.style.height = "30px";
          bar.style.background = "black";
          bar.style.opacity = 1;

          overlay.appendChild(bar);

          setTimeout(() => {
            overlay.style.opacity = 0;

            setTimeout(() => {
              el.style.color = "black";
              overlay.remove();
            }, 50);
          }, 20);
        }, duration);
      }

      window.addEventListener("DOMContentLoaded", () => {
        glitchText(".maurice-lebrun > span");
      });
    </script>
  </body>
</html>
